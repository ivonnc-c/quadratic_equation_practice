<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼è‡ªå‹•å‡ºé¡Œç³»çµ±</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                packages: {'[+]': ['noerrors', 'noundefined']}
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                typeset: false 
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; }
        .math-display { overflow-x: auto; padding: 0.2rem 0; }
        .math-display::-webkit-scrollbar { height: 4px; }
        .math-display::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 2px; }
        
        /* Inline math alignment adjustment */
        .inline-math-wrapper mjx-container {
            margin: 0 !important;
            vertical-align: middle !important;
        }

        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            .page-break { page-break-inside: avoid; }
        }
        
        /* Custom animation for collapse */
        .collapse-content {
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            max-height: 200px;
            opacity: 1;
            overflow: hidden;
        }
        .collapse-content.collapsed {
            max-height: 0;
            opacity: 0;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- Math Rendering Component ---
        const MathDisplay = ({ latex, className = "text-xl text-gray-900", inline = false }) => {
            const node = useRef(null);
            
            useEffect(() => {
                if (window.MathJax && window.MathJax.typesetPromise && node.current) {
                    node.current.innerHTML = '';
                    const math = document.createElement('span');
                    math.innerHTML = inline ? `\\( ${latex} \\)` : `$$ ${latex} $$`; 
                    node.current.appendChild(math);
                    window.MathJax.typesetPromise([node.current]).catch((err) => console.log(err));
                }
            }, [latex, inline]);

            if (inline) {
                return <span ref={node} className="inline-math-wrapper inline-block mx-1 text-gray-900 font-serif"></span>;
            }

            return <div ref={node} className={`math-display font-serif ${className}`}></div>;
        };

        // --- Utility Functions ---
        
        const gcd = (a, b) => {
            a = Math.round(Math.abs(a));
            b = Math.round(Math.abs(b));
            return b === 0 ? a : gcd(b, a % b);
        };

        const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        
        const randNonZero = (min, max) => {
            let res = 0;
            while (res === 0) res = randInt(min, max);
            return res;
        };

        const simplifyFrac = (num, den) => {
            num = Math.round(num);
            den = Math.round(den);

            if (den === 0) return { n: 0, d: 1 };
            if (den < 0) { num = -num; den = -den; }
            const common = gcd(num, den);
            return { n: num / common, d: den / common };
        };

        const formatQuadratic = (a, b, c) => {
            let str = "";
            if (a === 1) str += "x^2"; else if (a === -1) str += "-x^2"; else str += `${a}x^2`;
            if (b > 0) str += (str ? "+" : "") + (b === 1 ? "x" : `${b}x`); else if (b < 0) str += (b === -1 ? "-x" : `${b}x`);
            if (c > 0) str += `+${c}`; else if (c < 0) str += `${c}`;
            if (!str) str = "0"; 
            return `${str} = 0`;
        };

        const buildRootsString = (type, data) => {
            if (type === "no_solution") return "\\text{ç„¡å¯¦æ•¸è§£}";
            
            if (type === "rational") {
                const { v1n, v1d, v2n, v2d, isEqual } = data;
                let r1 = (v1d === 1) ? `${v1n}` : `\\frac{${v1n}}{${v1d}}`;
                if (isEqual) return `x = ${r1} \\quad (\\text{é‡æ ¹})`;
                let r2 = (v2d === 1) ? `${v2n}` : `\\frac{${v2n}}{${v2d}}`;
                return `x = ${r1}, ${r2}`;
            }
            
            if (type === "irrational") {
                const { negB, surdCoef, surdInner, den } = data;
                
                if (surdInner === 1) {
                    let n1 = negB + surdCoef;
                    let n2 = negB - surdCoef;
                    let f1 = simplifyFrac(n1, den);
                    let f2 = simplifyFrac(n2, den);
                    let r1 = (f1.d === 1) ? `${f1.n}` : `\\frac{${f1.n}}{${f1.d}}`;
                    let r2 = (f2.d === 1) ? `${f2.n}` : `\\frac{${f2.n}}{${f2.d}}`;
                    if (n1 === n2) return `x = ${r1} \\quad (\\text{é‡æ ¹})`;
                    return `x = ${r1}, ${r2}`;
                }

                const common = gcd(Math.abs(negB), gcd(Math.abs(surdCoef), Math.abs(den)));
                const sB = negB / common;
                const sCoef = surdCoef / common;
                const sDen = den / common;
                
                let sqrtPart = (sCoef === 1) ? `\\sqrt{${surdInner}}` : `${sCoef}\\sqrt{${surdInner}}`;
                
                if (sDen === 1) {
                    if (sB === 0) return `x = \\pm ${sqrtPart}`;
                    return `x = ${sB} \\pm ${sqrtPart}`;
                } else {
                    let numStr = (sB === 0) ? `\\pm ${sqrtPart}` : `${sB} \\pm ${sqrtPart}`;
                    return `x = \\frac{${numStr}}{${sDen}}`;
                }
            }
            return "";
        };

        // --- Generators ---
        const generateFactorProblem = (subTypes) => {
            const type = subTypes[randInt(0, subTypes.length - 1)];
            let a, b, c, qStr, ansData;

            // Helper to format fraction coeff equation: (A/k)x^2 + (B/k)x + (C/k) = 0
            const formatFractionEq = (A, B, C, k) => {
                const formatTerm = (coeff, isFirst = false) => {
                    if (coeff === 0) return "";
                    
                    let sign = "";
                    if (coeff < 0) sign = "-";
                    else if (!isFirst) sign = "+";
                    
                    let absCoeff = Math.abs(coeff);
                    let f = simplifyFrac(absCoeff, k);
                    
                    let valStr = "";
                    if (f.d === 1) {
                         if (f.n !== 1) valStr = `${f.n}`; // e.g., 2
                         // if 1, usually omitted before x, but kept if constant
                    } else {
                        valStr = `\\frac{${f.n}}{${f.d}}`;
                    }
                    
                    return { sign, valStr, isOne: (f.n === 1 && f.d === 1) };
                };

                let t1 = formatTerm(A, true);
                let t2 = formatTerm(B, false);
                let t3 = formatTerm(C, false);

                let s = "";
                // x^2 term
                s += t1.sign + (t1.valStr === "" && t1.isOne ? "" : t1.valStr) + "x^2";
                
                // x term
                if (B !== 0) {
                     s += t2.sign + (t2.valStr === "" && t2.isOne ? "" : t2.valStr) + "x";
                }
                
                // constant
                if (C !== 0) {
                    // For constant, we always need the value even if it's 1
                    let cStr = t3.valStr === "" ? "1" : t3.valStr;
                    s += t3.sign + cStr;
                }
                
                return s + " = 0";
            };

            // 1. Common Factor
            if (type === 'common') {
                let r = randNonZero(-9, 9); let k = randNonZero(1, 5);
                a = k; b = -k * r; c = 0;
                ansData = { type: 'rational', v1n: 0, v1d: 1, v2n: r, v2d: 1, isEqual: false };
                qStr = formatQuadratic(a, b, c);
            } 
            // 2. Difference of Squares
            else if (type === 'diff_sq') {
                let m = randNonZero(1, 5); let n = randNonZero(1, 9);
                let comm = gcd(m*m, n*n); a = (m*m)/comm; b = 0; c = -(n*n)/comm;
                let f = simplifyFrac(n, m);
                ansData = { type: 'rational', v1n: f.n, v1d: f.d, v2n: -f.n, v2d: f.d, isEqual: false };
                qStr = formatQuadratic(a, b, c);
            } 
            // 3. Perfect Square
            else if (type === 'perfect') {
                let m = randInt(1, 3); let n = randNonZero(-9, 9);
                a = m*m; b = 2*m*n; c = n*n;
                let f = simplifyFrac(-n, m);
                ansData = { type: 'rational', v1n: f.n, v1d: f.d, v2n: f.n, v2d: f.d, isEqual: true };
                qStr = formatQuadratic(a, b, c);
            } 
            // 4. Standard Cross
            else if (type === 'standard') {
                let m = randInt(1, 3); let n = randInt(1, 4);
                let p = randNonZero(-9, 9); let q = randNonZero(-9, 9);
                a = m*n; b = m*q + n*p; c = p*q; if (c === 0) c = 1;
                let comm = gcd(Math.abs(a), gcd(Math.abs(b), Math.abs(c))); 
                a/=comm; b/=comm; c/=comm;
                let f1 = simplifyFrac(-p, m); let f2 = simplifyFrac(-q, n);
                let isEqual = (f1.n === f2.n && f1.d === f2.d);
                ansData = { type: 'rational', v1n: f1.n, v1d: f1.d, v2n: f2.n, v2d: f2.d, isEqual };
                qStr = formatQuadratic(a, b, c);
            }
            // 5. Expand & Arrange (New)
            else if (type === 'expand') {
                // Goal: (x+m)(x+n) = k
                // 1. Decide target roots r1, r2 (integers)
                let r1 = randNonZero(-8, 8);
                let r2 = randNonZero(-8, 8);
                // Target: x^2 - (r1+r2)x + r1r2 = 0
                let S = r1 + r2; // Sum
                let P = r1 * r2; // Prod
                
                // We want form (x+m)(x+n) = k
                // Expand: x^2 + (m+n)x + mn = k
                // Compare: m+n = -S, mn - k = P
                
                // 2. Pick random m
                let m = randInt(-9, 9);
                // 3. Solve for n
                let n = -S - m;
                // 4. Solve for k
                let k = m * n - P;

                // If k=0, it's just standard factoring, force k!=0
                while (k === 0) {
                    m = randInt(-9, 9);
                    n = -S - m;
                    k = m * n - P;
                }

                // Construct problem string
                let part1 = m === 0 ? "x" : `(x ${m > 0 ? "+" : ""} ${m})`;
                let part2 = n === 0 ? "x" : `(x ${n > 0 ? "+" : ""} ${n})`;
                qStr = `${part1}${part2} = ${k}`;

                // Answers are r1, r2
                ansData = { type: 'rational', v1n: r1, v1d: 1, v2n: r2, v2d: 1, isEqual: r1 === r2 };
            }
            // 6. Fractional Coeffs (New)
            else if (type === 'fraction') {
                // Start with standard integer problem
                let m = randInt(1, 2); let n = randInt(1, 3);
                let p = randNonZero(-6, 6); let q = randNonZero(-6, 6);
                a = m*n; b = m*q + n*p; c = p*q;
                
                // Pick a denominator k
                let k = [2, 3, 4, 5][randInt(0, 3)];
                
                qStr = formatFractionEq(a, b, c, k);
                
                let f1 = simplifyFrac(-p, m); let f2 = simplifyFrac(-q, n);
                let isEqual = (f1.n === f2.n && f1.d === f2.d);
                ansData = { type: 'rational', v1n: f1.n, v1d: f1.d, v2n: f2.n, v2d: f2.d, isEqual };
            }
            
            return { q: qStr, a: buildRootsString(ansData.type, ansData), method: 'å› å¼åˆ†è§£' };
        };

        const generateSquareProblem = (subTypes) => {
            const type = subTypes[randInt(0, subTypes.length - 1)];
            let qStr, ansStr;
            const getSurd = (val) => {
                let c = 1, i = val;
                for(let j=2; j*j<=i; j++){ while(i % (j*j) === 0) { c*=j; i/=(j*j); } }
                return { c, i };
            };
            if (type === 'sq_basic') { 
                let h = randNonZero(-9, 9); let k = randInt(2, 25);
                if (Math.random() > 0.5) k = randInt(2, 6) ** 2;
                let sign = h > 0 ? "+" : ""; qStr = `(x ${sign} ${h})^2 = ${k}`;
                let sqrtK = Math.sqrt(k);
                if (Number.isInteger(sqrtK)) {
                    ansStr = buildRootsString('rational', { v1n: -h + sqrtK, v1d: 1, v2n: -h - sqrtK, v2d: 1, isEqual: false });
                } else {
                    let s = getSurd(k);
                    ansStr = buildRootsString('irrational', { negB: -h, surdCoef: s.c, surdInner: s.i, den: 1 });
                }
            } else if (type === 'sq_coeff') { 
                let a = randInt(2, 5); let h = randNonZero(-5, 5);
                let k = randInt(1, 10) * a; if (Math.random() > 0.7) k += 1;
                let sign = h > 0 ? "+" : ""; qStr = `${a}(x ${sign} ${h})^2 = ${k}`;
                let f = simplifyFrac(k, a);
                let product = f.n * f.d;
                let s = getSurd(product);
                if (s.i === 1) {
                     let numTerm1 = -h * f.d + s.c;
                     let numTerm2 = -h * f.d - s.c;
                     let term1 = simplifyFrac(numTerm1, f.d);
                     let term2 = simplifyFrac(numTerm2, f.d);
                     ansStr = buildRootsString('rational', { v1n: term1.n, v1d: term1.d, v2n: term2.n, v2d: term2.d, isEqual: false });
                } else {
                    ansStr = buildRootsString('irrational', { negB: -h * f.d, surdCoef: s.c, surdInner: s.i, den: f.d });
                }
            } else if (type === 'sq_gen_1') {
                let h = randNonZero(-6, 6); let k = randInt(2, 20);
                let b = 2 * h; let c = h*h - k;
                qStr = formatQuadratic(1, b, c);
                let s = getSurd(k);
                if (s.i === 1) ansStr = buildRootsString('rational', { v1n: -h + s.c, v1d: 1, v2n: -h - s.c, v2d: 1, isEqual: false });
                else ansStr = buildRootsString('irrational', { negB: -h, surdCoef: s.c, surdInner: s.i, den: 1 });
            } else {
                let aVal = randInt(2, 3); let h = randNonZero(-3, 3); let k = randInt(1, 15);
                let bVal = 2 * aVal * h; let cVal = aVal * h * h - k;
                qStr = formatQuadratic(aVal, bVal, cVal);
                let bigD = aVal * k; 
                let s = getSurd(bigD);
                if (s.i === 1) {
                    let numTerm1 = (-aVal*h) + s.c;
                    let numTerm2 = (-aVal*h) - s.c;
                    let t1 = simplifyFrac(numTerm1, aVal);
                    let t2 = simplifyFrac(numTerm2, aVal);
                    ansStr = buildRootsString('rational', { v1n: t1.n, v1d: t1.d, v2n: t2.n, v2d: t2.d, isEqual: false });
                }
                else ansStr = buildRootsString('irrational', { negB: -aVal*h, surdCoef: s.c, surdInner: s.i, den: aVal });
            }
            return { q: qStr, a: ansStr, method: 'é…æ–¹æ³•' };
        };

        const generateFormulaProblem = (subTypes) => {
            const type = subTypes[randInt(0, subTypes.length - 1)];
            let a, b, c;
            if (type === 'none') {
                a = randInt(1, 4); c = randInt(4, 10); b = randInt(-3, 3);
            } else if (type === 'equal') {
                let m = randInt(1, 3); let n = randNonZero(-4, 4); a = m*m; b = 2*m*n; c = n*n;
            } else {
                a = randInt(1, 4); b = randNonZero(-9, 9); c = randNonZero(-9, 9);
                while ((b*b - 4*a*c) < 0) { c = randInt(-9, -1); if (c===0) c=1; }
            }
            let qStr = formatQuadratic(a, b, c); let D = b*b - 4*a*c; let ansStr = "";
            if (D < 0) ansStr = buildRootsString('no_solution', {});
            else if (D === 0) {
                let f = simplifyFrac(-b, 2*a);
                ansStr = buildRootsString('rational', { v1n: f.n, v1d: f.d, v2n: f.n, v2d: f.d, isEqual: true });
            } else {
                let sqrtD = Math.sqrt(D);
                let sqrtInt = Math.round(sqrtD);
                let isPerfectSq = (sqrtInt * sqrtInt === D);

                if (isPerfectSq) {
                    let num1 = -b + sqrtInt; let num2 = -b - sqrtInt; let den = 2*a;
                    let f1 = simplifyFrac(num1, den); let f2 = simplifyFrac(num2, den);
                    ansStr = buildRootsString('rational', { v1n: f1.n, v1d: f1.d, v2n: f2.n, v2d: f2.d, isEqual: false });
                } else {
                    let surdCoef = 1; let inner = D;
                    for(let i=2; i*i<=inner; i++){ while(inner % (i*i) === 0) { surdCoef*=i; inner/=(i*i); } }
                    ansStr = buildRootsString('irrational', { negB: -b, surdCoef: surdCoef, surdInner: inner, den: 2*a });
                }
            }
            return { q: qStr, a: ansStr, method: 'å…¬å¼è§£' };
        };

        const App = () => {
            const [mode, setMode] = useState('factor');
            const [problems, setProblems] = useState([]);
            const [numQuestions, setNumQuestions] = useState(6);
            const [showAnswers, setShowAnswers] = useState(false);
            const [viewMode, setViewMode] = useState('list'); // 'list' or 'tv'
            
            const [subTypes, setSubTypes] = useState({
                // Factor
                factor_common: true, factor_diff: true, factor_perfect: true, factor_cross: true,
                factor_expand: false, factor_fraction: false, // New types
                // Square
                sq_basic: true, sq_coeff: false, sq_gen_1: true, sq_gen_a: false,
                // Formula
                form_distinct: true, form_equal: false, form_none: false
            });

            const generate = () => {
                const activeGens = [];
                if(mode==='factor' || mode==='mixed'){
                    let t=[];
                    if(subTypes.factor_common) t.push('common'); 
                    if(subTypes.factor_diff) t.push('diff_sq');
                    if(subTypes.factor_perfect) t.push('perfect'); 
                    if(subTypes.factor_cross) t.push('standard');
                    if(subTypes.factor_expand) t.push('expand'); // New
                    if(subTypes.factor_fraction) t.push('fraction'); // New
                    if(t.length) activeGens.push(() => generateFactorProblem(t));
                }
                if(mode==='square' || mode==='mixed'){
                    let t=[];
                    if(subTypes.sq_basic) t.push('sq_basic'); if(subTypes.sq_coeff) t.push('sq_coeff');
                    if(subTypes.sq_gen_1) t.push('sq_gen_1'); if(subTypes.sq_gen_a) t.push('sq_gen_a');
                    if(t.length) activeGens.push(() => generateSquareProblem(t));
                }
                if(mode==='formula' || mode==='mixed'){
                    let t=[];
                    if(subTypes.form_distinct) t.push('distinct'); if(subTypes.form_equal) t.push('equal');
                    if(subTypes.form_none) t.push('none');
                    if(t.length) activeGens.push(() => generateFormulaProblem(t));
                }
                if(activeGens.length === 0) { alert("è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®é¡Œå‹ï¼"); return; }
                const newP = [];
                for(let i=0; i<numQuestions; i++){
                    const gen = activeGens[randInt(0, activeGens.length - 1)];
                    newP.push({ id: Date.now()+i, ...gen() });
                }
                setProblems(newP);
                setShowAnswers(false);
            };

            const toggleSubType = (k) => setSubTypes(p => ({...p, [k]: !p[k]}));

            return (
                <div className={`min-h-screen ${viewMode === 'tv' ? 'bg-gray-900 p-2' : 'p-4 md:p-8 bg-gray-50'}`}>
                    
                    {/* Header (Only show in List Mode) */}
                    {viewMode !== 'tv' && (
                        <div className="max-w-5xl mx-auto mb-4">
                            <header className="mb-6 text-center">
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹å¼ ç·´ç¿’ç”Ÿæˆå™¨</h1>
                                <div className="flex justify-center gap-2">
                                    {['factor','square','formula','mixed'].map(m => (
                                        <button key={m} onClick={()=>setMode(m)} 
                                            className={`px-4 py-1 rounded-full text-sm font-bold ${mode===m ? 'bg-blue-600 text-white' : 'bg-white border'}`}>
                                            {m==='factor'?'å› å¼åˆ†è§£': m==='square'?'é…æ–¹æ³•': m==='formula'?'å…¬å¼è§£':'æ··åˆ'}
                                        </button>
                                    ))}
                                </div>
                            </header>
                        </div>
                    )}

                    {/* Settings Panel (Only in List Mode) */}
                    {viewMode === 'list' && (
                        <div className="max-w-5xl mx-auto bg-white p-5 rounded-xl shadow-sm mb-6 border border-gray-200">
                            <h3 className="font-bold text-gray-700 mb-2 border-b pb-1">ç´°é …è¨­å®š</h3>
                            <div className="flex flex-wrap gap-3">
                                {(mode==='factor'||mode==='mixed') && <>
                                    <label className="flex items-center gap-1 bg-blue-50 px-2 py-1 rounded cursor-pointer select-none"><input type="checkbox" checked={subTypes.factor_common} onChange={()=>toggleSubType('factor_common')}/>æå…¬å› å¼</label>
                                    <label className="flex items-center gap-1 bg-blue-50 px-2 py-1 rounded cursor-pointer select-none"><input type="checkbox" checked={subTypes.factor_diff} onChange={()=>toggleSubType('factor_diff')}/>å¹³æ–¹å·®</label>
                                    <label className="flex items-center gap-1 bg-blue-50 px-2 py-1 rounded cursor-pointer select-none"><input type="checkbox" checked={subTypes.factor_perfect} onChange={()=>toggleSubType('factor_perfect')}/>å®Œå…¨å¹³æ–¹</label>
                                    <label className="flex items-center gap-1 bg-blue-50 px-2 py-1 rounded cursor-pointer select-none"><input type="checkbox" checked={subTypes.factor_cross} onChange={()=>toggleSubType('factor_cross')}/>åå­—äº¤ä¹˜</label>
                                    <label className="flex items-center gap-1 bg-purple-50 px-2 py-1 rounded cursor-pointer select-none ring-1 ring-purple-200"><input type="checkbox" checked={subTypes.factor_expand} onChange={()=>toggleSubType('factor_expand')}/>å…ˆå±•é–‹æ•´ç†</label>
                                    <label className="flex items-center gap-1 bg-purple-50 px-2 py-1 rounded cursor-pointer select-none ring-1 ring-purple-200"><input type="checkbox" checked={subTypes.factor_fraction} onChange={()=>toggleSubType('factor_fraction')}/>ä¿‚æ•¸ç‚ºåˆ†æ•¸</label>
                                </>}
                                {(mode==='square'||mode==='mixed') && <>
                                    <label className="flex items-center gap-1 bg-green-50 px-2 py-1 rounded cursor-pointer select-none">
                                        <input type="checkbox" checked={subTypes.sq_basic} onChange={()=>toggleSubType('sq_basic')}/>
                                        <span>åŸºç¤ <MathDisplay latex="(x+h)^2=k" inline /></span>
                                    </label>
                                    <label className="flex items-center gap-1 bg-green-50 px-2 py-1 rounded cursor-pointer select-none">
                                        <input type="checkbox" checked={subTypes.sq_coeff} onChange={()=>toggleSubType('sq_coeff')}/>
                                        <span>ä¿‚æ•¸ <MathDisplay latex="a(x+h)^2=k" inline /></span>
                                    </label>
                                    <label className="flex items-center gap-1 bg-green-50 px-2 py-1 rounded cursor-pointer select-none">
                                        <input type="checkbox" checked={subTypes.sq_gen_1} onChange={()=>toggleSubType('sq_gen_1')}/>
                                        <span>ä¸€èˆ¬ (<MathDisplay latex="a=1" inline />)</span>
                                    </label>
                                    <label className="flex items-center gap-1 bg-green-50 px-2 py-1 rounded cursor-pointer select-none">
                                        <input type="checkbox" checked={subTypes.sq_gen_a} onChange={()=>toggleSubType('sq_gen_a')}/>
                                        <span>é€²éš (<MathDisplay latex="a \neq 1" inline />)</span>
                                    </label>
                                </>}
                                {(mode==='formula'||mode==='mixed') && <>
                                    <label className="flex items-center gap-1 bg-orange-50 px-2 py-1 rounded cursor-pointer select-none"><input type="checkbox" checked={subTypes.form_distinct} onChange={()=>toggleSubType('form_distinct')}/>ç›¸ç•°å¯¦æ ¹</label>
                                    <label className="flex items-center gap-1 bg-orange-50 px-2 py-1 rounded cursor-pointer select-none"><input type="checkbox" checked={subTypes.form_equal} onChange={()=>toggleSubType('form_equal')}/>é‡æ ¹</label>
                                    <label className="flex items-center gap-1 bg-orange-50 px-2 py-1 rounded cursor-pointer select-none"><input type="checkbox" checked={subTypes.form_none} onChange={()=>toggleSubType('form_none')}/>ç„¡è§£</label>
                                </>}
                            </div>
                        </div>
                    )}

                    {/* Problem Display Area */}
                    <div className={viewMode === 'tv' ? 'mx-auto max-w-7xl' : 'max-w-5xl mx-auto'}>
                         {/* Tools Bar - Integrated Controls (Now includes generation tools) */}
                         <div className={`flex flex-wrap gap-4 justify-between items-center mb-4 ${viewMode==='tv'?'text-white':''}`}>
                            <div className="flex items-center gap-4">
                                <h3 className="text-xl font-bold opacity-80 flex items-center gap-3">
                                    {viewMode === 'tv' ? 'æŠ•å½±æ¨¡å¼' : 'é¡Œç›®åˆ—è¡¨'}
                                    {problems.length > 0 && <span className={`text-sm font-normal px-2 py-0.5 rounded ${viewMode==='tv'?'bg-gray-700':'bg-gray-200 text-gray-600'}`}>å…± {problems.length} é¡Œ</span>}
                                </h3>
                                
                                {/* Edit Mode Generation Controls (Always visible in List Mode) */}
                                {viewMode === 'list' && (
                                    <div className="flex items-center gap-2">
                                        <select value={numQuestions} onChange={(e)=>setNumQuestions(Number(e.target.value))} className="border p-1.5 rounded text-sm text-gray-700">
                                            <option value="4">4 é¡Œ</option>
                                            <option value="6">6 é¡Œ</option>
                                            <option value="8">8 é¡Œ</option>
                                            <option value="10">10 é¡Œ</option>
                                            <option value="12">12 é¡Œ</option>
                                            <option value="20">20 é¡Œ</option>
                                        </select>
                                        <button onClick={generate} className="bg-blue-600 text-white font-bold py-1.5 px-3 rounded shadow hover:bg-blue-700 text-sm flex items-center gap-1">
                                            <span>ğŸ² ç”Ÿæˆ</span>
                                        </button>
                                    </div>
                                )}
                            </div>
                            
                            <div className="flex gap-2">
                                <button onClick={()=>setShowAnswers(!showAnswers)} 
                                    className={`px-4 py-2 rounded font-bold border transition-colors ${showAnswers ? 'bg-red-500 text-white border-red-600' : (viewMode==='tv' ? 'bg-gray-700 text-gray-200 border-gray-600 hover:bg-gray-600' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50')}`}>
                                    {showAnswers ? 'ğŸ™ˆ éš±è—è§£ç­”' : 'ğŸ‘ï¸ é¡¯ç¤ºè§£ç­”'}
                                </button>
                                
                                <button onClick={()=>setViewMode(viewMode==='list'?'tv':'list')}
                                    className={`px-4 py-2 rounded font-bold flex items-center gap-2 border ${viewMode==='tv' ? 'bg-purple-600 text-white border-purple-700 hover:bg-purple-500' : 'bg-white text-purple-700 border-purple-200 hover:bg-purple-50'}`}>
                                    {viewMode==='list' ? 'ğŸ–¥ï¸ æŠ•å½±æ¨¡å¼' : 'ğŸ“ ç·¨è¼¯æ¨¡å¼'}
                                </button>
                            </div>
                        </div>

                        {/* Grid / List Layout */}
                        {problems.length > 0 ? (
                            <div className={`grid gap-4 ${
                                viewMode === 'tv' 
                                ? 'grid-cols-2' // TV Mode: Strictly 2 columns as requested
                                : 'grid-cols-1' // List Mode: 1 column
                            }`}>
                                {problems.map((p, idx) => (
                                    <div key={p.id} className={`relative rounded-xl border-l-8 transition-all ${
                                        viewMode === 'tv' 
                                        ? 'bg-gray-800 border-yellow-500 px-4 py-0.5 shadow-xl' // Reduced vertical padding
                                        : 'bg-white border-blue-500 p-4 shadow-sm'
                                    }`}>
                                        <div className="flex justify-between items-start">
                                            <span className={`text-sm font-mono px-2 py-1 rounded inline-block ${viewMode==='tv'?'bg-gray-700 text-gray-300':'bg-gray-100 text-gray-500'}`}>
                                                Q{idx + 1}
                                            </span>
                                            {viewMode !== 'tv' && <span className="text-xs text-gray-400">{p.method}</span>}
                                        </div>

                                        {/* Question - Size adjusted for TV mode */}
                                        <div className={`text-center font-serif ${viewMode==='tv'?'my-0':'my-2'}`}>
                                            <MathDisplay 
                                                latex={p.q} 
                                                className={viewMode==='tv' ? 'text-3xl text-white' : 'text-2xl text-gray-900'} 
                                            />
                                        </div>

                                        {/* Answer Area - Collapsible in TV Mode */}
                                        {(!showAnswers && viewMode === 'tv') ? null : (
                                            <div className={`mt-2 pt-2 border-t flex items-center justify-center
                                                ${viewMode === 'tv' ? 'border-gray-700 min-h-[2rem]' : 'border-gray-100 min-h-[3rem] mt-4 pt-3'}
                                            `}>
                                                {showAnswers ? (
                                                    <div className={`animate-bounce-in font-bold ${viewMode==='tv'?'text-yellow-400':'text-red-600'}`}>
                                                        <MathDisplay 
                                                            latex={p.a} 
                                                            className={viewMode==='tv' ? 'text-xl text-yellow-400' : 'text-xl text-red-600'} 
                                                        />
                                                    </div>
                                                ) : (
                                                    <span className="text-gray-400 italic text-sm">...</span>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        ) : (
                            /* Empty State - Guides user to generate */
                            <div className="text-center py-12 border-2 border-dashed border-gray-300 rounded-xl">
                                <p className="text-gray-500 text-lg">ğŸ‘‡ è¨­å®šå¥½é¡Œå‹å¾Œï¼Œé»æ“Šä¸Šæ–¹ã€Œç”Ÿæˆã€æŒ‰éˆ•é–‹å§‹ç·´ç¿’</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
